version: '3.8'

services:
  # USB ADB connection (default)
  whatsapp-export-usb:
    build: .
    image: whatsapp-export:latest
    container_name: whatsapp-export
    privileged: true  # Required for USB device access
    volumes:
      # USB device access
      - /dev/bus/usb:/dev/bus/usb
      # Output directory
      - ./output:/output
      # Downloads directory (optional, for intermediate files)
      - ./downloads:/downloads
    environment:
      - OUTPUT_DIR=/output
      - DOWNLOADS_DIR=/downloads
    # Override command here or via: docker-compose run whatsapp-export-usb --output /output --limit 5
    command: ["--output", "/output"]
    profiles:
      - usb

  # Wireless ADB connection
  whatsapp-export-wireless:
    build: .
    image: whatsapp-export:latest
    container_name: whatsapp-export-wireless
    network_mode: host  # Required for wireless ADB
    volumes:
      # Output directory
      - ./output:/output
      # Downloads directory (optional)
      - ./downloads:/downloads
    environment:
      - OUTPUT_DIR=/output
      - DOWNLOADS_DIR=/downloads
      # Set your device IP here
      - DEVICE_IP=192.168.1.100:5555
    # Override command here or via: docker-compose run whatsapp-export-wireless --output /output --wireless-adb $DEVICE_IP
    command: ["--output", "/output", "--wireless-adb", "192.168.1.100:5555"]
    profiles:
      - wireless

  # Development/testing mode (interactive)
  whatsapp-export-dev:
    build: .
    image: whatsapp-export:latest
    container_name: whatsapp-export-dev
    privileged: true
    volumes:
      - /dev/bus/usb:/dev/bus/usb
      - ./output:/output
      - ./downloads:/downloads
      # Mount source code for development
      - .:/app
    environment:
      - OUTPUT_DIR=/output
      - DOWNLOADS_DIR=/downloads
    # Just show help by default
    command: ["--help"]
    profiles:
      - dev

# Networks (only used if not using host networking)
networks:
  default:
    driver: bridge
